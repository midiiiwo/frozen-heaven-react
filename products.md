# Products Management

## Overview

Complete guide for managing products in the Frozen Heaven system.

## Product Schema

```typescript
interface Product {
  id?: string;
  name: string;
  category: string;
  price: number;
  description: string;
  imageName: string;
  stock: number;
  createdAt?: Date;
  updatedAt?: Date;
}
```

## API Functions

### 1. Get All Products

Retrieves all products from the database, ordered by creation date (newest first).

```typescript
import { getAllProducts } from "../api/products";

const products = await getAllProducts();
```

**Use Cases:**

- Display all products in shop
- Admin product listing
- Inventory reports

### 2. Get Product by ID

Fetches a single product by its unique ID.

```typescript
const product = await getProductById("abc123");
```

**Use Cases:**

- Product detail page
- Edit product form
- Order item details

### 3. Get Products by Category

Filter products by category name.

```typescript
const poultryProducts = await getProductsByCategory("Poultry");
const allProducts = await getProductsByCategory("All");
```

**Categories:**

- All
- Poultry
- Turkey
- Fish & Seafood
- Processed Meat
- Poultry Parts
- Offals(Beef)
- Meat

### 4. Create Product

Add a new product to the database.

```typescript
const newProduct = await createProduct({
  name: "Chicken Wings",
  category: "Poultry Parts",
  price: 56,
  description: "Fresh chicken wings, perfect for grilling",
  imageName: "chicken-wings.png",
  stock: 70,
});
```

**Validation:**

- All fields are required
- Price must be positive
- Stock must be non-negative
- imageName should be filename only

**Auto-Created Fields:**

- `id` - Generated by Firestore
- `createdAt` - Current timestamp
- `updatedAt` - Current timestamp

### 5. Update Product

Modify existing product details.

```typescript
await updateProduct("abc123", {
  price: 60,
  stock: 80,
  description: "Updated description",
});
```

**What Updates:**

- Only provided fields are updated
- `updatedAt` is automatically set

### 6. Delete Product

Remove a product from the database.

```typescript
await deleteProduct("abc123");
```

**Warning:** This action cannot be undone!

### 7. Update Stock

Quick function to update only the stock quantity.

```typescript
await updateProductStock("abc123", 100);
```

**Use Cases:**

- After order placement
- Manual inventory adjustment
- Restocking

### 8. Search Products

Search across product name, description, and category.

```typescript
const results = await searchProducts("chicken");
```

**Search Algorithm:**

- Case-insensitive
- Searches in: name, description, category
- Returns all matching products

## React Query Hooks

### Query Hooks

#### useGetProducts

Get all products with caching and auto-refetch.

```typescript
import { useGetProducts } from '../hooks/useGetProducts';

function ProductList() {
  const { data: products, isLoading, error, refetch } = useGetProducts();

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error loading products</div>;

  return (
    <div>
      {products?.map(product => (
        <div key={product.id}>{product.name}</div>
      ))}
    </div>
  );
}
```

**Features:**

- Automatic caching (5 minutes)
- Background refetch
- Error handling
- Loading states

#### useGetProduct

Get single product by ID.

```typescript
const { data: product } = useGetProduct(productId);
```

**Note:** Only fetches when `productId` is truthy.

#### useGetProductsByCategory

Filter products by category.

```typescript
const { data: products } = useGetProductsByCategory("Poultry");
```

### Mutation Hooks

#### useCreateProduct

```typescript
function AddProductForm() {
  const createProduct = useCreateProduct();

  const handleSubmit = () => {
    createProduct.mutate({
      name: "New Product",
      category: "Poultry",
      price: 50,
      description: "Description",
      imageName: "image.png",
      stock: 100
    }, {
      onSuccess: () => {
        alert('Product created!');
      },
      onError: () => {
        alert('Failed to create product');
      }
    });
  };

  return (
    <button
      onClick={handleSubmit}
      disabled={createProduct.isPending}
    >
      {createProduct.isPending ? 'Creating...' : 'Create Product'}
    </button>
  );
}
```

**Auto-Invalidation:**

- Invalidates `['products']` query
- Triggers re-fetch of product lists

#### useUpdateProduct

```typescript
const updateProduct = useUpdateProduct();

updateProduct.mutate({
  id: "abc123",
  product: { price: 60, stock: 50 },
});
```

#### useDeleteProduct

```typescript
const deleteProduct = useDeleteProduct();

const handleDelete = (id: string) => {
  if (confirm("Are you sure?")) {
    deleteProduct.mutate(id);
  }
};
```

#### useUpdateProductStock

```typescript
const updateStock = useUpdateProductStock();

const decreaseStock = (productId: string, quantity: number) => {
  updateStock.mutate({
    id: productId,
    stock: currentStock - quantity,
  });
};
```

## Image Handling

### Image Storage

Images are stored in: `src/assets/products/`

### Naming Convention

```
product-name.png
product-name.jpg
product-name.webp
```

### When Creating Products

```typescript
{
  imageName: "chicken-wings.png"; // ✅ Correct
  imageName: "/assets/products/chicken-wings.png"; // ❌ Wrong
}
```

### Displaying Images

```tsx
import { getProductImage } from "../lib/imageHelper";

<img src={getProductImage(product.imageName)} alt={product.name} />;
```

### Default Fallback

If image not found, displays: `/images/default-product.png`

## Price List Products (Seed Data)

### Poultry (7 products)

- Layer Chicken (Hard) - GHC 48
- Layer Chicken (Back) - GHC 32
- Chicken Brassils (Soft) - GHC 40
- Chicken Back - GHC 28
- Drumsticks - GHC 45
- Chicken Wings - GHC 56
- Gizzard - GHC 38

### Turkey (1 product)

- Turkey Wings - GHC 62

### Fish & Seafood (6 products)

- Red Fish - GHC 70
- Abidjan Salmon - GHC 70
- Local Salmon - GHC 44
- P/S 16 - GHC 40
- Tilapia - GHC 70
- Cassava Fish - GHC 45

### Processed Meat (4 products)

- Royal Sausage - GHC 18
- Sadia Sausage - GHC 20
- Prime Beef Sausage - GHC 45
- Pramag Chicken/Beef Sausage - GHC 43

### Offals(Beef) (4 products)

- Sinews (Intini) - GHC 50
- Intestines - GHC 10
- Cow Leg - GHC 10
- Cow Meat - GHC 20

**Total: 22 Products**

## Admin Features

### Product Management Page

Location: `/admin/products`

**Features:**

- View all products in table format
- Search by name
- Filter by category
- Stock level indicators (color-coded)
- Quick edit/delete actions
- Add new product button

### Stock Indicators

```
Green:  Stock > 30 (Healthy)
Yellow: Stock 10-30 (Low)
Red:    Stock < 10 (Critical)
```

### Bulk Operations

To add all seed products:

1. Go to `/admin/settings`
2. Click "Seed Database"
3. Confirm action
4. Wait for completion message

## Best Practices

### 1. Stock Management

```typescript
// After order placement
const order = await createOrder(orderData);
if (order) {
  // Decrease stock for each item
  for (const item of order.items) {
    const product = await getProductById(item.id);
    if (product) {
      await updateProductStock(item.id, product.stock - item.quantity);
    }
  }
}
```

### 2. Form Validation

```typescript
const validateProduct = (product: Partial<Product>) => {
  if (!product.name || product.name.trim() === "") {
    return "Name is required";
  }
  if (!product.price || product.price <= 0) {
    return "Price must be positive";
  }
  if (!product.stock || product.stock < 0) {
    return "Stock cannot be negative";
  }
  return null;
};
```

### 3. Error Handling

```typescript
try {
  const product = await createProduct(newProduct);
  if (product) {
    console.log("Success:", product.id);
  } else {
    console.error("Failed to create product");
  }
} catch (error) {
  console.error("Error:", error);
}
```

### 4. Optimistic Updates

```typescript
const updateMutation = useUpdateProduct();

updateMutation.mutate(
  {
    id: productId,
    product: updates,
  },
  {
    onMutate: async () => {
      // Cancel outgoing refetches
      await queryClient.cancelQueries(["products"]);

      // Snapshot previous value
      const previousProducts = queryClient.getQueryData(["products"]);

      // Optimistically update
      queryClient.setQueryData(["products"], (old) => {
        // Update logic
      });

      return { previousProducts };
    },
    onError: (err, variables, context) => {
      // Rollback on error
      queryClient.setQueryData(["products"], context.previousProducts);
    },
  }
);
```

## Common Issues

### Issue: Images Not Loading

**Solution:**

1. Check image is in `src/assets/products/`
2. Verify `imageName` is just filename
3. Use `getProductImage()` helper

### Issue: Stock Goes Negative

**Solution:**
Add validation before updating:

```typescript
if (newStock < 0) {
  alert("Insufficient stock");
  return;
}
```

### Issue: Category Filter Not Working

**Solution:**
Ensure category name matches exactly (case-sensitive):

```typescript
"Poultry"; // ✅
"poultry"; // ❌
```

## Performance Tips

1. **Use React Query Caching**
   - Products cached for 5 minutes
   - Reduces Firebase reads

2. **Pagination** (Future Enhancement)

```typescript
const { data, fetchNextPage } = useInfiniteQuery({
  queryKey: ["products"],
  queryFn: ({ pageParam = 0 }) => getProductsPaginated(pageParam),
});
```

3. **Index Firestore Fields**
   - Category (for filtering)
   - createdAt (for sorting)
   - name (for searching)

## Changelog

### [Completed]

- ✅ Complete CRUD operations
- ✅ React Query hooks
- ✅ Category filtering
- ✅ Stock management
- ✅ Search functionality
- ✅ Auto-collection creation
- ✅ Seed data for 22 products

### [Future Enhancements]

- [ ] Image upload functionality
- [ ] Bulk import from CSV
- [ ] Product variants (sizes, colors)
- [ ] Inventory alerts
- [ ] Product reviews
